#include <stdio.h>
#include <Windows.h>
#include <stdlib.h>
#include <conio.h>

// 키보드 값
#define UP 0
#define DOWN 1
#define LEFT 2
#define RIGHT 3
#define SPACE 4

// player 구조체
struct player {
	// 직업 ,경험치, 체력, 레벨, 행운력, 공격력, 들고있는 아이템(문자열), 아이템들(문자열 배열)
	int job;
	int level;
	int hp;
	float attack;
	float luck;
	double exp;
	char* item;
	char* bags;
};

// 아이템 구조체
struct armor_item {
	// 체력 증가, 행운력 증가
	int increase_hp;
	double increase_luck;
};

struct attack_item {
	// 공격력증가
	double increase_attack;
};

// 적 구조체
struct enemy {
	// 체력, 레벨, 공격력, 몹이 들고있는 아이템(문자열), 몹 유형(졸개, 보스)
	int hp;
	int level;
	int attack;
	char* mop_item;
	char* mop_category;
};

static void gotoxy(int x, int y) {
	COORD curserPostion = { x, y };
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), curserPostion);
}

// 함수 선언부
int startLayout();
void showLayout();
void runAway();
void showingPlayerInfo(struct player *p);
int attack(int damege, int hp);
char* selectItems(char *itmes);
int keyControl();
int selectMenu();
int selectPlayer(struct player *p);
void getBag(struct player *p);


// 메인 함수
int main(void) {
	// smenuCode = 1 or 2
	int smenuCode = startLayout();
	if (smenuCode == 2) {
		return 0;
	}
	else if(smenuCode == 1) {
		system("cls");
		struct player(*players) = malloc(sizeof(struct player));
		showLayout();
		selectPlayer(players);
		showingPlayerInfo(players);
		int smenu = selectMenu();
		if (smenu == 1) {
			printf("총 공격~");
		}
		else if (smenu == 2) {
			runAway();
		}
	}
}

int selectMenu() {
	int x, y = 0;
	x = 183;
	y = 54;
	gotoxy(x, y);
	printf("   1. 전투준비.    \n");
	gotoxy(x, y + 1);
	printf("   2. 도망간다.    \n");

	while (1) {
		int n = keyControl();
		switch (n) {
		case UP:
			if (y > 54) {
				gotoxy(x - 2, y);
				printf(" ");
				gotoxy(x - 2, --y);
				printf(">");
			}
			break;

		case DOWN:
			if (y < 55) {
				gotoxy(x - 2, y);
				printf(" ");
				gotoxy(x - 2, ++y);
				printf(">");
			}
			break;

		case SPACE:
			return y - 53;
		}
	}
}

// 캐릭터 유형 선택 -> 사용자로 입력받고 보이는 입력값 지워버리기
int selectPlayer(struct player *p) {
	int x = 65;
	int y = 14;
	gotoxy(x, y);
	// 메인 화면에 출력
	printf("========== 뱀파이어의 성향을 고르세요. ==========\n");
	x = 45;
	y = 24;
	gotoxy(x, y );
	printf("1. 탱커형 뱀파이어\n");
	gotoxy(x, y + 1);
	printf("기본 체력: 35 │ 기본 공격력: 2.7\n");
	gotoxy(x, y + 10);
	printf("2. 딜러형 뱀파이어\n");
	gotoxy(x, y + 11);
	printf("기본 체력: 17 │ 기본 공격력: 5.0\n");
	// 사이드 하단에 입력할 수 있게.
	x = 181;
	y = 52;
	gotoxy(x, y);
	scanf_s("%d", &p->job);
	gotoxy(x, y);
	printf(" ");
	if (p->job == 1) {
		p->hp = 35;
		p->attack = 2.7;
	}
	else if (p->job == 2) {
		p->hp = 17;
		p->attack = 5.0;
	}
	p->level = 1;
	p->exp = 0.0;
	p->luck = 1.1;
	p->item = "잭나이프";
	p->bags = p->item;
	x = 45;
	y = 24;
	printf("\n");
	return 0;
}

void getBags(struct player* p) {

}

// 현재 능력치 보여주기.
void showingPlayerInfo(struct player *p) {
	int x = 185;
	int y = 5;
	if (p->job == 1) {
		gotoxy(x, y);
		printf("플레이어 타입: 탱커형\n");
	}
	else {
		gotoxy(x, y);
		printf("플레이어 타입: 딜러형\n");
	}
	gotoxy(x, y+1);
	printf("현재 체력: %d\n", p->hp);
	gotoxy(x, y + 2);
	printf("현재 장착중인 장비: %s\n", p->item);
	gotoxy(x, y + 3);
	printf("공격력: %.2f\n", p->attack);
	gotoxy(x, y + 4);
	printf("행운력: %.2f\n", p->luck);
	gotoxy(x, y + 5);
	printf("레벨: %d.LV \n", p->level);
	gotoxy(x, y + 6);
	printf("경험치: %.5f\n", p->exp);
	getBags(p);
}

// 전투시 도망(0~9중에서 6까지는 도망이 가능하고 6보다 크면 도망에 못가는 확률)
void runAway() {
	int x = 80;
	int y = 50;
	srand(time(NULL));
	int random = 0;
	random = rand() % 9;
	if (random <= 6) {
		gotoxy(x, y);
		printf("무사히 도망쳤습니다.");
	}
	else {
		gotoxy(x, y);
		printf("도망가지 못하였습니다.");
	}
};

// 전투시 공격(parameter로 현재 공격력과 공격받는 상대의 체력을 받음. 후에 공격을 받은 후의 체력을 반환함.)
int attack(int damege, int hp) {
	return 0;
}

// 현재 가지고 있는 아이템 중 선택
char* selectItems(char* items) {
	return "items";
}

// 키보드 컨트롤 함수
int keyControl() {
	char temp = _getch();

	if (temp == 'w' || temp == 'W') {
		return UP;
	}
	else if (temp == 'a' || temp == 'A') {
		return LEFT;
	}
	else if (temp == 's' || temp == 'S') {
		return DOWN;
	}
	else if (temp == 'd' || temp == 'D') {
		return RIGHT;
	}
	else if (temp == ' ') {
		return SPACE;
	}
}

// 게임 실행시 보여줄 레이아웃
int startLayout() {
	int x = 190;
	int y = 54;

	SetConsoleTitle(TEXT("파멸의 성 - Castle of Doom"));
	printf("┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐───────────────────────────────────────────┐\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│ \033[0;33m                                                                     ##                 ###                                                                                     \033[0;37m│                                           │\n");
	printf("│ \033[0;33m                                                ####              ## ##                ##     ####                                                                              \033[0;37m│                                           │\n");
	printf("│ \033[0;33m                                              ##     ###    ### #### ##  ###     ###  #####   ## ##   ###   ###  # ## #                                                         \033[0;37m│                                           │\n");
	printf("│ \033[0;33m                                             ##        ##  ##    ##  ## ## ##   ## ##  ##     ##  ## ## ## ## ## ## ## ##                                                       \033[0;37m│                                           │\n");
	printf("│ \033[0;33m                                             ##        ##  ##    ##  ## ## ##   ## ##  ##     ##  ## ## ## ## ## ## ## ##                                                       \033[0;37m│                                           │\n");
	printf("│ \033[0;33m                                             ##      ####  ###   ##  ## ## ##   ## ##  ##     ##  ## ## ## ## ## ## ## ##                                                       \033[0;37m│                                           │\n");
	printf("│ \033[0;33m                                             ##     ## ##   ###  ##  ## #####   ## ##  ##     ##  ## ## ## ## ## ## ## ##                                                       \033[0;37m│                                           │\n");
	printf("│ \033[0;33m                                              ##    ## ##    ##  ##  ## ##      ## ##  ##     ## ##  ## ## ## ## ## ## ##                                                       \033[0;37m│                                           │\n");
	printf("│ \033[0;33m                                               ####  ## ## ###    ## ##  ####    ###   ##     ####    ###   ###  ## ## ##                                                       \033[0;37m│                                           │\n");
	printf("│                                                                                                                                                                                 \033[0;37m│                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                           \033[0;31m!!!!!!;;;;;;;;;;:::::::::::::;;;;;;;;!!!!!!!!!!!!!\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m!!!!!!!;;;;;;;;;;;:::::::::::::;;;;;;;;;;!!!!!!!!!\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m!!!!!!!!;;;;;;;;;;\033[0;30m***********!!\033[0;31m;;;;;;;;;;!!!!!!!!!\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m!!!!!!;;;;;;;;;\033[0;30m!*$##@@@#######$==!\033[0;31m:;::;;;;!;!!!!!!\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m!!!;;;;;;;;;;\033[0;30m!*##@@####@########@$!\033[0;31m:::::;;;;;;!!!!\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m!!!!;;;;;;;;;\033[0;30m*#@@@@@#####$#####@@#$!\033[0;31m:::::;;;;;;;;;\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;;;;;;;;;;;\033[0;30m*@@@@@###@##@#$$$###@@@$\033[0;31m;:::::;;;;;;;;\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;;;;;;;;;;\033[0;30m*#@@@@###$#$##$#######@@@=\033[0;31m::::::;;;;;;;\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;;;;;;;;;\033[0;30m!#@#@@@#################@#@*\033[0;31m::::::::::::\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;;;;;;;;;\033[0;30m=#@@@#########@########@@@@#!\033[0;31m:::::::::~~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;;;;;;;;\033[0;30m*##@@@@########@########@@@@@$\033[0;31m:::::::~~~~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;;;;;;;\033[0;30m!=#@@@@@@#@#############@@@@@##!\033[0;31m:::::::~~~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;;;;;;;\033[0;30m*##@@@@@###$$$$$##$$$$$#@@@@@@@=\033[0;31m::::::::::\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;;;;;;;\033[0;30m*@@@@@@@####@#@#$$@#@####@@@@#@$\033[0;31m::::::::::\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m;;::;::;\033[0;30m##@@@@@@###@@####$##@@####@@@#@#!\033[0;31m:::::::::\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m:::::::\033[0;30m!#@@@@@@@###@@@########@###@@@@#@\033[0;31m*~~~::::::\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m:::::::\033[0;30m=@@@@@@@@##@@@@#######@@@###@@@#@=:\033[0;31m~~~~~:::\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m~~:::::\033[0;30m#@@@@@@@##@@@@######@#@@####@@@#@#\033[0;31m;~~~~~~~~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m~~:::::\033[0;30m#@@@@@@@##@@@@######@#@@####@@@#@#\033[0;31m;~~~~~~~~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m~~~~~~:\033[0;30m#@@@@@@###!\033[0;37m;!;!;=\033[0;30m$\033[0;37m!;:-:;;\033[0;30m###@@@##@!\033[0;31m~~~~~~~~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m----~~~\033[0;30m#@@@@@@###!;\033[0;37m,.........\033[0;30m~;;####@@##@$\033[0;31m:~~~~~~~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m------~\033[0;30m@@@@@@##@#!;\033[0;37m....,~,....\033[0;30m:;#####@##@#\033[0;31m:~~----~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m,,,,,--\033[0;30m@@@@@###@#!:\033[0;37m....~;~-...\033[0;30m:;########@#*\033[0;31m~-----~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m,,,,,,-\033[0;30m@@##@##@@#!-\033[0;37m..,--;~;~,.\033[0;30m~;########@##\033[0;31m~-----~\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m,,,,,,;\033[0;30m@@########!\033[0;37m...-:,;:;:-.,;\033[0;30m#######@@@#\033[0;31m~------\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m,,,,,,\033[0;30m#@@########@$!\033[0;37m,.,,;;:-.-\033[0;30m$@@###@@#@@@#\033[0;31m=------\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m,,,,,,\033[0;30m#@@########@$\033[0;37m!,.,,;;:-.-\033[0;30m$@@###@@#@@@#\033[0;31m=------\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m,,,,,\033[0;30m~#@@####@###!#=\033[0;37m--~;--!--\033[0;30m=$;=###@##@@@@#\033[0;31m:-----\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m,,,,,\033[0;30m$@@@########\033[0;37m*\033[0;30m!-=##\033[0;37m!!!\033[0;30m##==;!\033[0;37m=\033[0;30m@##@#@@@@@#$\033[0;31m,-,,,\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m...,\033[0;30m;#@@@###@###*\033[0;37m::~~;*!!-=;~~-~\033[0;30m*@##@#@@@@@#$~\033[0;31m,,,,\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m...,\033[0;30m=#@@@@##@###\033[0;37m**~~,-~;!-;,,,*:!\033[0;30m###@##@#@@##;\033[0;31m,,,,\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m...;\033[0;30m#@@@@###@##$\033[0;37m!-,,,,,:!-;-..--;=\033[0;30m##@##@#@@##$\033[0;31m**!!\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m...\033[0;30m*@@@@@##@@##\033[0;37m=~,,,,,~;!-;~.,.,,*\033[0;30m##@####@@###$$\033[0;31m=;\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m,:\033[0;30m=#@@@@@##@@@#=\033[0;37m;,,,,,~;!-;~,,,,-*\033[0;30m@#@####@@@##$$\033[0;31m=;\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m=\033[0;30m$$##@@@@@##@@##\033[0;37m=!;,,,:;!-;:,,,;**\033[0;30m#@@@@@#@@####\033[0;31m==:\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m=\033[0;30m$$##@@#####@@##=*\033[0;37m;,,,-*!-;-,,,;;*\033[0;30m@@@@@@###@##$$\033[0;31m=:\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m=\033[0;30m$$###@##@@#@@###$\033[0;37m;,,,\033[0;30m!#!!#\033[0;37m*-,,;;*\033[0;30m#@##@@######$$!\033[0;31m;\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m\033[0;30m=$#@@#@##@@@#@##$!\033[0;37m;,:\033[0;30m@@#@@#@#\033[0;37m=;;1=\033[0;30m#@###@##@##$=!\033[0;31m;;\033[0;37m                                                                    ├───────────────────────────────────────────┤\n");
	printf("│                                                           \033[0;31m\033[0;30m=$####@######@##*;!\033[0;30m$$$$=*;!**;!;\033[0;30m!##@@#@@####****\033[0;31m!;\033[0;37m                                                                    │");
	printf("                                           │\n");
	printf("│                                                           \033[0;31m*=\033[0;30m$#######@##@#@*\033[0;37m;!:,--,,,,-~,;;\033[0;30m*@#@@#@####==#@@$\033[0;31m!\033[0;37m                                                                    │");
	printf("                                           │\n");
	printf("│                                                           \033[0;31m!*=\033[0;30m#@#####@@#@##*\033[0;37m;;;~;;::::;;~;;!\033[0;30m@#@@@@###$$@@@\033[0;31m:;;\033[0;37m                                                                    │");
	gotoxy(x - 2, y); // -2 > 출력할려고
	printf("               1. GAME START               │\n");
	printf("│                                                           \033[0;31m$!=\033[0;30m$#@#@##@@###@**\033[0;37m!;~;--~=--;*;;\033[0;30m;*##@#@###$#@@@@\033[0;31m@@\033[0;37m                                                                    │");
	gotoxy(x, y + 1);
	printf("	          2. GAME EXIT                │\n");
	printf("│                                                           \033[0;31m@$*=$#\033[0;30m@@@@@@###@*;\033[0;37m=;,-,,;#,,,;!\033[0;30m$!=###@###$#@@\033[0;31m@@@@@\033[0;37m                                                                    │                                           │\n");
	printf("│                                                           \033[0;31m@$*=$#@@@@@@###@*;=\033[0;37m;;,-,,;#,,,\033[0;31m;!$!=###@###$#@@@@@@\033[0;37m                                                                    │                                           │\n");
	printf("└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘───────────────────────────────────────────┘\n");
	while (1) {
		int n = keyControl();
		switch (n) {
		case UP:
			if (y > 54) {
				gotoxy(x - 2, y);
				printf(" ");
				gotoxy(x - 2, --y);
				printf(">");
			}
			break;

		case DOWN:
			if (y < 55) {
				gotoxy(x - 2, y);
				printf(" ");
				gotoxy(x - 2, ++y);
				printf(">");
			}
			break;

		case SPACE:
			return y - 53;
		}
	}	
};

void showLayout() {
	SetConsoleTitle(TEXT("파멸의 성 - Castle of Doom"));
	printf("┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐───────────────────────────────────────────┐\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                                                                                                                                                 │                                           │\n");
	printf("│                                                        ┏                                                              ┓                                                         │                                           │\n");
	printf("│                                                        ┃                                                              ┃                                                         │                                           │\n");
	printf("│                                                        ┃                                                              ┃                                                         │                                           │\n");
	printf("│                                                        ┃                                                              ┃                                                         │                                           │\n");
	printf("│                                                        ┃                                                              ┃                                                         ├───────────────────────────────────────────┤\n");
	printf("│                                                        ┃                                                              ┃                                                         │                                           │\n");
	printf("│                                                        ┃                                                              ┃                                                         │                                           │\n");
	printf("│                                                        ┃                                                              ┃                                                         │                                           │\n");
	printf("│                                                        ┃                                                              ┃                                                         │                                           │\n");
	printf("│                                                        ┃                                                              ┃                                                         │                                           │\n");
	printf("│                                                        ┗                                                              ┛                                                         │                                           │\n");
	printf("└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘───────────────────────────────────────────┘\n");
};
